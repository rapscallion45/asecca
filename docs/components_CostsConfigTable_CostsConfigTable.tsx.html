<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/CostsConfigTable/CostsConfigTable.tsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/CostsConfigTable/CostsConfigTable.tsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { FC, useState, useEffect, useCallback } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { AppState, AppDispatch } from '@/redux/store';
import { Box, Button } from '@mui/material';
import { LoadingButton } from '@mui/lab';
import DataTable from '@/components/DataTable/DataTable';
import { ICostsConfigData } from '@/lib/api/api-types';
import {
  getCostsConfigColFilterList,
  getCostsConfigPostData,
  getCostsConfigPrevailingCharge,
} from '@/utils';
import {
  saveBySourceId as saveCostsConfigBySourceId,
  resetCostsConfig,
  editCostsConfig,
} from '@/redux/slices/costsConfigSlice';
import { IDataTableColumn } from '@/components/DataTable/types';
import { IUserPermissionLevelState } from '@/redux/types';
import columns from './costsConfigTableColumns';

/**
 * Costs Config Data Table Props
 *
 * @author Carl Scrivener {@link https://github.com/rapscallion45 GitHub}
 * @since 0.0.0
 *
 * @typedef ICostsConfigTableProps
 * @prop {IUserPermissionLevelState} permission - permission level of table
 * @prop {string} query - query string of fetch table data API call
 */
interface ICostsConfigTableProps {
  permission: IUserPermissionLevelState;
  query: string;
}

/**
 * Costs Config Data Table
 *
 * Presents the Costs Configuration table to the user, populated with data
 * fetched from API: /api/costs_config
 *
 * @author Carl Scrivener {@link https://github.com/rapscallion45 GitHub}
 * @since 0.0.0
 *
 * @component
 * @param {ICostsConfigTableProps} props - component props
 * @returns {FC} - costs config table functional component
 */
const CostsConfigTable: FC&lt;ICostsConfigTableProps> = (props) => {
  const { permission, query } = props;

  /* shorthand helper for dispatching redux actions */
  const dispatch = useDispatch&lt;AppDispatch>();

  /* get costs config data held in redux state */
  const { data, loading, error, saving, edited } = useSelector(
    (state: AppState) => state.costsConfig
  );

  /**
   * Table column filter list
   *
   * Local state of filtered columns list for current permission level
   *
   * @since 0.0.0
   *
   * @constant
   */
  const [colFilterList, setColFilterList] = useState&lt;Array&lt;string | null>>(
    getCostsConfigColFilterList(permission.level)
  );

  /**
   * Whenever the user permission global state is updated, re-filter cols
   *
   * @author Carl Scrivener {@link https://github.com/rapscallion45 GitHub}
   * @since 0.0.0
   */
  useEffect(() => {
    setColFilterList(getCostsConfigColFilterList(permission.level));
  }, [permission.level]);

  /**
   * Handles the saving of the table data
   *
   * @author Carl Scrivener {@link https://github.com/rapscallion45 GitHub}
   * @since 0.0.0
   *
   * @method
   */
  const handleSave = useCallback(() => {
    dispatch(
      saveCostsConfigBySourceId({
        data: getCostsConfigPostData(permission.level, query, data?.costs),
      })
    );
  }, [permission.level, query, data?.costs, dispatch]);

  /**
   * Handles the resetting of the table data
   *
   * @author Carl Scrivener {@link https://github.com/rapscallion45 GitHub}
   * @since 0.0.0
   *
   * @method
   */
  const handleCancel = useCallback(() => {
    dispatch(resetCostsConfig());
  }, [dispatch]);

  /**
   * Handles the update of the table data
   *
   * @author Carl Scrivener {@link https://github.com/rapscallion45 GitHub}
   * @since 0.0.0
   *
   * @method
   * @param {string | null} value - value to be used in update
   * @param {string} colKey - column key to be updated
   * @param {number} rowIdx - table row index to be updated
   */
  const handleEditCellValue = useCallback(
    (value: string | null, colKey: string, rowIdx: number) => {
      dispatch(
        editCostsConfig({
          value: value !== '--' ? value : null,
          colKey: colKey as keyof ICostsConfigData,
          rowIdx,
        })
      );
    },
    [dispatch]
  );

  /**
   * Handles any required logic when determining a cell's display value
   *
   * @author Carl Scrivener {@link https://github.com/rapscallion45 GitHub}
   * @since 0.0.0
   *
   * @method
   * @param {number} rowIdx - table row index to get value from
   * @param {IDataTableColumn} column - column to get value from
   */
  const handleGetCellValue = useCallback(
    (rowIdx: number, column: IDataTableColumn) => {
      /* apply Prevailing column logic or simply return value */
      if (column.label === 'Prevailing')
        return getCostsConfigPrevailingCharge(data?.costs[rowIdx], permission);
      return data?.costs[rowIdx][column.key as keyof ICostsConfigData];
    },
    [data?.costs, permission]
  );

  return (
    &lt;>
      &lt;DataTable
        name="costs config"
        /* filter table columns by current permission level */
        columns={columns.filter(
          (col: IDataTableColumn) => !colFilterList.includes(col.label)
        )}
        /* table editable cell(s) defined by user permission level */
        editableColLabels={[permission.level]}
        /* build table row props from costs config data */
        rows={data?.costs.map((cost: ICostsConfigData) => ({
          label: cost.name,
        }))}
        isLoading={loading}
        error={error}
        editCellValueCallback={handleEditCellValue}
        getCellValueCallback={handleGetCellValue}
      />
      &lt;Box
        sx={{
          marginTop: 10,
          display: 'flex',
          flexDirection: 'row',
          alignItems: 'center',
          justifyContent: 'center',
        }}
      >
        &lt;LoadingButton
          color="secondary"
          variant="contained"
          onClick={handleSave}
          disabled={saving || loading || !edited}
          loading={saving}
        >
          Save
        &lt;/LoadingButton>
        &lt;Button
          color="secondary"
          variant="outlined"
          onClick={handleCancel}
          disabled={saving || loading || !edited}
          sx={{ backgroundColor: 'common.white', ml: 2 }}
        >
          Cancel
        &lt;/Button>
      &lt;/Box>
    &lt;/>
  );
};

export default CostsConfigTable;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminTestPanel.html">AdminTestPanel</a></li><li><a href="AlertNotification.html">AlertNotification</a></li><li><a href="AlertProvider.html">AlertProvider</a></li><li><a href="Cell.html">Cell</a></li><li><a href="ClientOnly.html">ClientOnly</a></li><li><a href="CostsConfigPage.html">CostsConfigPage</a></li><li><a href="CostsConfigTable.html">CostsConfigTable</a></li><li><a href="CurrencyCell.html">CurrencyCell</a></li><li><a href="DashboardBackgroundStyle.html">DashboardBackgroundStyle</a></li><li><a href="DashboardLayout.html">DashboardLayout</a></li><li><a href="DashboardRootStyle.html">DashboardRootStyle</a></li><li><a href="DataRow.html">DataRow</a></li><li><a href="DataRow-StyledTableRow.html">StyledTableRow</a></li><li><a href="DataTable.html">DataTable</a></li><li><a href="DefaultLayout.html">DefaultLayout</a></li><li><a href="ErrorRow.html">ErrorRow</a></li><li><a href="HeaderRow.html">HeaderRow</a></li><li><a href="HeaderRow-StyledTableHeadCell.html">StyledTableHeadCell</a></li><li><a href="Home.html">Home</a></li><li><a href="HomeBackgroundStyle.html">HomeBackgroundStyle</a></li><li><a href="HomeLayout.html">HomeLayout</a></li><li><a href="HomeRootStyle.html">HomeRootStyle</a></li><li><a href="LoadingRow.html">LoadingRow</a></li><li><a href="Meta.html">Meta</a></li><li><a href="NavBar.html">NavBar</a></li><li><a href="StyledTableCell.html">StyledTableCell</a></li><li><a href="ThemeConfig.html">ThemeConfig</a></li></ul><h3>Interfaces</h3><ul><li><a href="IAddNotificationPayload.html">IAddNotificationPayload</a></li><li><a href="IAlertNotificationProps.html">IAlertNotificationProps</a></li><li><a href="IAlertProviderProps.html">IAlertProviderProps</a></li><li><a href="ICellProps.html">ICellProps</a></li><li><a href="IClientOnlyProps.html">IClientOnlyProps</a></li><li><a href="ICloseNotificationPayload.html">ICloseNotificationPayload</a></li><li><a href="ICostsConfigData.html">ICostsConfigData</a></li><li><a href="ICostsConfigDataPayload.html">ICostsConfigDataPayload</a></li><li><a href="ICostsConfigEditCostsPayload.html">ICostsConfigEditCostsPayload</a></li><li><a href="ICostsConfigSaveDataCosts.html">ICostsConfigSaveDataCosts</a></li><li><a href="ICostsConfigSaveDataPayload.html">ICostsConfigSaveDataPayload</a></li><li><a href="ICostsConfigSaveDataSelection.html">ICostsConfigSaveDataSelection</a></li><li><a href="ICostsConfigState.html">ICostsConfigState</a></li><li><a href="ICostsConfigTableProps.html">ICostsConfigTableProps</a></li><li><a href="ICurrencyCellProps.html">ICurrencyCellProps</a></li><li><a href="IDashboardLayoutProps.html">IDashboardLayoutProps</a></li><li><a href="IDataRowProps.html">IDataRowProps</a></li><li><a href="IDataTableColumn.html">IDataTableColumn</a></li><li><a href="IDataTableEditCellValueCallback.html">IDataTableEditCellValueCallback</a></li><li><a href="IDataTableEditCurrencyCellValueCallback.html">IDataTableEditCurrencyCellValueCallback</a></li><li><a href="IDataTableGetCellValueCallback.html">IDataTableGetCellValueCallback</a></li><li><a href="IDataTableProps.html">IDataTableProps</a></li><li><a href="IDataTableRow.html">IDataTableRow</a></li><li><a href="IDefaultLayoutProps.html">IDefaultLayoutProps</a></li><li><a href="IErrorRowProps.html">IErrorRowProps</a></li><li><a href="IExtendedColorPartial.html">IExtendedColorPartial</a></li><li><a href="IFetchCostsConfigBySourceIdArgs.html">IFetchCostsConfigBySourceIdArgs</a></li><li><a href="IHeaderRowProps.html">IHeaderRowProps</a></li><li><a href="IHomeLayoutProps.html">IHomeLayoutProps</a></li><li><a href="IInitialCostsConfigState.html">IInitialCostsConfigState</a></li><li><a href="IInitialNotificationsState.html">IInitialNotificationsState</a></li><li><a href="IInitialThemeState.html">IInitialThemeState</a></li><li><a href="IInitialUserPermissionState.html">IInitialUserPermissionState</a></li><li><a href="ILoadingRowProps.html">ILoadingRowProps</a></li><li><a href="INavBarProps.html">INavBarProps</a></li><li><a href="INotificationOptions.html">INotificationOptions</a></li><li><a href="INotificationState.html">INotificationState</a></li><li><a href="IProxyErrorPayload.html">IProxyErrorPayload</a></li><li><a href="IRemoveNotificationPayload.html">IRemoveNotificationPayload</a></li><li><a href="IResposiveFontSizes.html">IResposiveFontSizes</a></li><li><a href="ISaveCostsConfigBySourceIdArgs.html">ISaveCostsConfigBySourceIdArgs</a></li><li><a href="IThemeConfigProps.html">IThemeConfigProps</a></li><li><a href="IThemeState.html">IThemeState</a></li><li><a href="IUserPermissionLevelState.html">IUserPermissionLevelState</a></li></ul><h3>Global</h3><ul><li><a href="global.html"></a></li><li><a href="global.html#DARKTHEME_ERROR">DARKTHEME_ERROR</a></li><li><a href="global.html#DARKTHEME_GREY">DARKTHEME_GREY</a></li><li><a href="global.html#DARKTHEME_INFO">DARKTHEME_INFO</a></li><li><a href="global.html#DARKTHEME_PRIMARY">DARKTHEME_PRIMARY</a></li><li><a href="global.html#DARKTHEME_SECONDARY">DARKTHEME_SECONDARY</a></li><li><a href="global.html#DARKTHEME_SUCCESS">DARKTHEME_SUCCESS</a></li><li><a href="global.html#DARKTHEME_WARNING">DARKTHEME_WARNING</a></li><li><a href="global.html#FONT_PRIMARY">FONT_PRIMARY</a></li><li><a href="global.html#LIGHTTHEME_ERROR">LIGHTTHEME_ERROR</a></li><li><a href="global.html#LIGHTTHEME_GREY">LIGHTTHEME_GREY</a></li><li><a href="global.html#LIGHTTHEME_INFO">LIGHTTHEME_INFO</a></li><li><a href="global.html#LIGHTTHEME_PRIMARY">LIGHTTHEME_PRIMARY</a></li><li><a href="global.html#LIGHTTHEME_SECONDARY">LIGHTTHEME_SECONDARY</a></li><li><a href="global.html#LIGHTTHEME_SUCCESS">LIGHTTHEME_SUCCESS</a></li><li><a href="global.html#LIGHTTHEME_WARNING">LIGHTTHEME_WARNING</a></li><li><a href="global.html#costsConfigSlice">costsConfigSlice</a></li><li><a href="global.html#costsConfigTableColumns">costsConfigTableColumns</a></li><li><a href="global.html#createEmotionCache">createEmotionCache</a></li><li><a href="global.html#darkThemePalette">darkThemePalette</a></li><li><a href="global.html#fetchBySourceId">fetchBySourceId</a></li><li><a href="global.html#getCostsConfig">getCostsConfig</a></li><li><a href="global.html#getCostsConfigColFilterList">getCostsConfigColFilterList</a></li><li><a href="global.html#getCostsConfigPostData">getCostsConfigPostData</a></li><li><a href="global.html#getCostsConfigPrevailingCharge">getCostsConfigPrevailingCharge</a></li><li><a href="global.html#getCostsConfigSourceQueryString">getCostsConfigSourceQueryString</a></li><li><a href="global.html#initialCostsConfigState">initialCostsConfigState</a></li><li><a href="global.html#initialNotificationsState">initialNotificationsState</a></li><li><a href="global.html#initialThemeState">initialThemeState</a></li><li><a href="global.html#initialUserPermissionState">initialUserPermissionState</a></li><li><a href="global.html#lightThemePalette">lightThemePalette</a></li><li><a href="global.html#notificationsSlice">notificationsSlice</a></li><li><a href="global.html#notifierDisplayedIds">notifierDisplayedIds</a></li><li><a href="global.html#permissions">permissions</a></li><li><a href="global.html#pxToRem">pxToRem</a></li><li><a href="global.html#responsiveFontSizes">responsiveFontSizes</a></li><li><a href="global.html#saveBySourceId">saveBySourceId</a></li><li><a href="global.html#setCostsConfig">setCostsConfig</a></li><li><a href="global.html#store">store</a></li><li><a href="global.html#themeSlice">themeSlice</a></li><li><a href="global.html#typography">typography</a></li><li><a href="global.html#useNotifier">useNotifier</a></li><li><a href="global.html#userPermissionSlice">userPermissionSlice</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Apr 21 2023 17:53:49 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
